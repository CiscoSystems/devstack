# ciscocfgagent
# -------------

# This file implements functions required to configure ciscocfgagent as the third-party
# system used with devstack's Neutron.  To include this file, specify the following
# variables in localrc:
#
# * enable_service ciscocfgagent
#


# Save trace setting
MY_XTRACE=$(set +o | grep xtrace)
set +o xtrace

function configure_ciscocfgagent() {
    Q_CISCO_CFGAGENT_ENABLED=True
    AGENT_CISCO_CFGAGENT_BINARY=${AGENT_CISCO_CFGAGENT_BINARY:-"$NEUTRON_BIN_DIR/neutron-cisco-cfg-agent"}
    CISCO_CFGAGENT_CONFIG_DIR=$NEUTRON_CONF_DIR/plugins/cisco
    mkdir -p $CISCO_CFGAGENT_CONFIG_DIR
    Q_CISCO_CFGAGENT_CONF_FILE=$CISCO_CFGAGENT_CONFIG_DIR/cisco_cfg_agent.ini

    cp $NEUTRON_DIR/neutron/plugins/cisco/l3/etc/cisco_cfg_agent.ini $Q_CISCO_CFGAGENT_CONF_FILE

    iniset $Q_CISCO_CFGAGENT_CONF_FILE DEFAULT verbose True
    iniset $Q_CISCO_CFGAGENT_CONF_FILE DEFAULT debug $ENABLE_DEBUG_LOG_LEVEL

    # Remove the next line later when cfg agent does not contain that code
    _neutron_setup_interface_driver $Q_CISCO_CFGAGENT_CONF_FILE

#    quantum_plugin_configure_cisco_cfg_agent
}

function init_ciscocfgagent() {
    :
}

function install_ciscocfgagent() {
    :
}

function start_ciscocfgagent() {
    CISCO_CFG_CONF_FILES="--config-file $NEUTRON_CONF --config-file=$Q_CISCO_CFGAGENT_CONF_FILE"
    screen_it q-ciscocfgagent "cd $NEUTRON_DIR && python $AGENT_CISCO_CFGAGENT_BINARY $CISCO_CFG_CONF_FILES"
}

function stop_ciscocfgagent() {
    :
}

function check_ciscocfgagent() {
    :
}

# Restore xtrace
$MY_XTRACE
